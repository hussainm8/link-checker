<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan</title>
  <style>
    :root {
      --bg: #0f172a; --card: #111827; --muted: #9ca3af; --text: #f9fafb;
      --accent: #22c55e; --danger: #ef4444; --warning: #f59e0b; --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: "Cairo", system-ui, sans-serif;
      background: radial-gradient(1200px 600px at 80% -10%, #1f2937 10%, var(--bg) 40%),
                  radial-gradient(1200px 600px at 20% 110%, #0b1120 10%, var(--bg) 40%);
      color: var(--text); min-height: 100vh; display: grid; place-items: center; padding: 24px;
    }
    .container {
      width: 100%; max-width: 760px; background: var(--card);
      border: 1px solid var(--border); border-radius: 16px; padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .title { margin: 0 0 6px; font-weight: 800; font-size: 1.6rem; }
    .subtitle { margin: 0 0 20px; color: var(--muted); font-size: 0.95rem; }
    .field {
      display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-top: 12px;
    }
    input[type="url"] {
      width: 100%; padding: 14px 16px; border-radius: 12px;
      border: 1px solid var(--border); background: #0b1220; color: var(--text);
      outline: none; transition: border-color .2s, box-shadow .2s;
    }
    input[type="url"]::placeholder { color: #6b7280; }
    input[type="url"]:focus {
      border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37,99,235,0.15);
    }
    button {
      padding: 12px 18px; border-radius: 12px; border: 1px solid #0ea5e9;
      background: linear-gradient(135deg, #0ea5e9, #2563eb);
      color: white; font-weight: 700; cursor: pointer; transition: transform .05s, box-shadow .2s;
    }
    button:hover { box-shadow: 0 8px 20px rgba(37,99,235,0.35); }
    button:active { transform: translateY(1px); }
    /* âœ… Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    button.loading {
      background: linear-gradient(135deg, #444, #666);
      cursor: wait;
    }
    .result {
      margin-top: 18px; padding: 14px; border-radius: 12px; border: 1px dashed var(--border);
      background: #0b1120;
    }
    .badge {
      display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px;
      border-radius: 999px; font-size: 0.85rem; margin-inline-end: 8px;
    }
    .ok { background: rgba(34,197,94,0.15); color: var(--accent); border: 1px solid rgba(34,197,94,0.35); }
    .warn { background: rgba(245,158,11,0.15); color: var(--warning); border: 1px solid rgba(245,158,11,0.35); }
    .bad { background: rgba(239,68,68,0.15); color: var(--danger); border: 1px solid rgba(239,68,68,0.35); }
    .muted { color: var(--muted); font-size: 0.92rem; }
    .list { margin-top: 12px; display: grid; gap: 8px; }
    .item { display: grid; grid-template-columns: 150px 1fr; gap: 8px; align-items: start; }
    .key { color: var(--muted); }
    .val { color: var(--text); word-break: break-word; }
    .footer { margin-top: 18px; color: var(--muted); font-size: 0.85rem; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Ø£Ø¯Ø§Ø© ÙØ­Øµ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</h1>
    <p class="subtitle">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø·Ù‹Ø§ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­ØªÙ‡ØŒ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ØŒ ÙˆØ§Ø·Ù‘Ù„Ø§Ø¹ Ø³Ø±ÙŠØ¹ Ø¹Ù„Ù‰ Ø­Ø§Ù„ØªÙ‡.</p>

    <div class="field">
      <input id="urlInput" type="url" placeholder="Ù…Ø«Ø§Ù„: https://example.com/path?x=1" autocomplete="on">
      <button id="checkBtn">ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
    </div>

    <div id="result" class="result hidden">
      <div id="statusBadges"></div>
      <div class="list">
        <div class="item"><div class="key">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ØµÙ„ÙŠ</div><div id="origUrl" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ø­Ø§Ù„Ø©</div><div id="statusText" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„</div><div id="protocol" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ù…Ø¶ÙŠÙ (Domain)</div><div id="hostname" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ù…Ù†ÙØ°</div><div id="port" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ù…Ø³Ø§Ø±</div><div id="path" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Query)</div><div id="query" class="val"></div></div>
        <div class="item"><div class="key">Ø§Ù„Ù€ URL Ø§Ù„Ù…Ù†Ø³Ù‘Ù‚</div><div id="normalized" class="val"></div></div>
      </div>
      <div class="footer">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© ÙŠØªÙ… Ø¹Ø¨Ø± backend Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹.</div>
    </div>
  </div>

  <script>
    // âœ… Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (ØºÙŠÙ‘Ø±Ù‡ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø·Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø±)
    const BACKEND_STATUS_CHECK_URL = "https://link-checker-api-0enu.onrender.com";    // Ù„Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø­Ù„ÙŠ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…:
    const input = document.getElementById("urlInput");
    const btn = document.getElementById("checkBtn");
    const result = document.getElementById("result");
    const statusBadges = document.getElementById("statusBadges");
    const statusText = document.getElementById("statusText");
    const origUrl = document.getElementById("origUrl");
    const protocol = document.getElementById("protocol");
    const hostname = document.getElementById("hostname");
    const port = document.getElementById("port");
    const path = document.getElementById("path");
    const query = document.getElementById("query");
    const normalized = document.getElementById("normalized");

    function isValidUrl(str) {
      try {
        const u = new URL(str);
        return ["http:", "https:"].includes(u.protocol);
      } catch {
        return false;
      }
    }

    function normalizeUrl(str) {
      const u = new URL(str);
      const norm = new URL(u.toString());
      if ((norm.protocol === "http:" && norm.port === "80") ||
          (norm.protocol === "https:" && norm.port === "443")) {
        norm.port = "";
      }
      const params = [...norm.searchParams.entries()].sort((a, b) => a[0].localeCompare(b[0]));
      norm.search = "";
      for (const [k, v] of params) norm.searchParams.append(k, v);
      return norm.toString();
    }

    async function checkHttpStatus(url) {
      if (!BACKEND_STATUS_CHECK_URL) return { supported: false };
      try {
        const res = await fetch(BACKEND_STATUS_CHECK_URL + encodeURIComponent(url), { method: "GET" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return { supported: true, ...(await res.json()) };
      } catch (e) {
        return { supported: true, error: e.message };
      }
    }

    function renderBadges({ isValid, isHttps, hasQuery, hasHash, httpStatus }) {
      statusBadges.innerHTML = "";
      const badges = [];

      badges.push({ text: isValid ? "âœ… ØµÙŠØºØ© ØµØ­ÙŠØ­Ø©" : "âŒ ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©", cls: isValid ? "ok" : "bad" });

      if (isValid) {
        badges.push({ text: isHttps ? "ğŸ”’ Ø¢Ù…Ù† (HTTPS)" : "âš ï¸ ØºÙŠØ± Ù…Ø´ÙÙ‘Ø± (HTTP)", cls: isHttps ? "ok" : "warn" });
        badges.push({ text: hasQuery ? "ğŸ“Š ÙŠØ­ÙˆÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª" : "â€” Ù„Ø§ ÙŠØ­ÙˆÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª", cls: hasQuery ? "warn" : "muted" });
        badges.push({ text: hasHash ? "#ï¸âƒ£ ÙŠØ­ÙˆÙŠ Hash" : "â€” Ù„Ø§ ÙŠØ­ÙˆÙŠ Hash", cls: hasHash ? "muted" : "muted" });
      }

      if (httpStatus?.status) {
        const ok = httpStatus.status >= 200 && httpStatus.status < 400;
        badges.push({ text: `ğŸŒ Ø­Ø§Ù„Ø© HTTP: ${httpStatus.status}`, cls: ok ? "ok" : "bad" });
      } else if (httpStatus?.error) {
        badges.push({ text: `âš ï¸ Ø®Ø·Ø£: ${httpStatus.error}`, cls: "warn" });
      } else if (httpStatus?.supported === false) {
        badges.push({ text: "ğŸ”§ Backend ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„", cls: "muted" });
      }

      badges.forEach(b => {
        const span = document.createElement("span");
        span.className = `badge ${b.cls}`;
        span.textContent = b.text;
        statusBadges.appendChild(span);
      });
    }

    btn.addEventListener("click", async () => {
      const urlStr = input.value.trim();
      result.classList.add("hidden");

      // âœ… Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
      btn.classList.add("loading");
      btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...";
      btn.disabled = true;

      const valid = isValidUrl(urlStr);
      let urlObj = null;

      if (valid) {
        urlObj = new URL(urlStr);
        origUrl.textContent = urlStr;
        protocol.textContent = urlObj.protocol.replace(":", "");
        hostname.textContent = urlObj.hostname;
        port.textContent = urlObj.port || "(Ø§ÙØªØ±Ø§Ø¶ÙŠ)";
        path.textContent = urlObj.pathname || "/";
        query.textContent = urlObj.search || "(Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª)";
        normalized.textContent = normalizeUrl(urlStr);
        statusText.textContent = "Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨ØµÙŠØºØ© ØµØ­ÙŠØ­Ø©.";
      } else {
        [origUrl, protocol, hostname, port, path, query, normalized].forEach(el => el.textContent = "-");
        statusText.textContent = "ØµÙŠØºØ© Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ø³ØªØ®Ø¯Ù… http:// Ø£Ùˆ https://";
      }

      const httpStatus = valid ? await checkHttpStatus(urlStr) : null;

      if (httpStatus?.error) {
        statusText.textContent += ` | ${httpStatus.error}`;
      } else if (httpStatus?.status) {
        statusText.textContent += ` | Ø§Ù„Ø­Ø§Ù„Ø©: ${httpStatus.status}`;
      }

      renderBadges({
        isValid: valid,
        isHttps: valid && urlObj?.protocol === "https:",
        hasQuery: valid && !!urlObj?.search,
        hasHash: valid && !!urlObj?.hash,
        httpStatus
      });

      result.classList.remove("hidden");

      // âœ… Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
      btn.classList.remove("loading");
      btn.textContent = "ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø·";
      btn.disabled = false;
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btn.click();
    });
  </script>
</body>
</html>